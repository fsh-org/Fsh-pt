<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Servers - Fsh Pterodactyl Panel</title>
    <!-- Boiler plate------ -->
    <link rel="icon" href="https://fsh.plus/fsh.png" type="image/png">
    <meta name="description" content="A pterodactyl panel replacement. List your servers (login required).">
    <!-- ------- -->
    <link rel="stylesheet" href="https://fsh.plus/NewStyle.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://fsh.plus/fsh.png"/>
    <meta name="theme-color" content="#a89c9b">
    <!-- ------------------ -->
    <link rel="stylesheet" href="/style.css">
    <script src="/script.js"></script>
    <style>
      #cpu, #ram, #disk, #uop, #up {
        flex: 1;
        background-color: #555;
        padding: 8px;
        margin: 5px;
        border-radius: 1rem;
      }
    </style>
  </head>
  <body>
    <div style="display:flex">
      <div id="state" style="flex:1;border-left:8px var(--status) solid;border-radius:0.5rem;padding-left:8px;">
        <h1 id="name">Name</h1>
        <label id="desc">Desc</label>
        <label id="node" class="subtext">Node</label>
      </div>
      <div style="flex:1;display:flex;align-items:center;">
        <button onclick="power('start')"><svg xmlns="http://www.w3.org/2000/svg" height="20" width="15" viewBox="0 0 384 512"><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></button>
        <button onclick="power('restart')"><svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 512 512"><path d="M463.5 224H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5z"/></svg></button>
        <button onclick="power('stop')"><svg xmlns="http://www.w3.org/2000/svg" height="20" width="15" viewBox="0 0 384 512"><path d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"/></svg></button>
        <button onclick="power('kill')" style="background-color:#c00"><svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 512 512"><path d="M416 398.9c58.5-41.1 96-104.1 96-174.9C512 100.3 397.4 0 256 0S0 100.3 0 224c0 70.7 37.5 133.8 96 174.9c0 .4 0 .7 0 1.1v64c0 26.5 21.5 48 48 48h48V464c0-8.8 7.2-16 16-16s16 7.2 16 16v48h64V464c0-8.8 7.2-16 16-16s16 7.2 16 16v48h48c26.5 0 48-21.5 48-48V400c0-.4 0-.7 0-1.1zM96 256a64 64 0 1 1 128 0A64 64 0 1 1 96 256zm256-64a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg></button>
      </div>
    </div>
    <div style="display:flex">
      <label id="cpu">CPU:<br>0%/0%</label>
      <label id="ram">Ram:<br>0B/0B</label>
      <label id="disk">Disk:<br>0B/0B</label>
      <a id="uop" target="_blank" style="color:#fff;text-decoration:none;"><label id="url">URL<br>IP</label></a>
      <label id="up">Uptime</label>
    </div>
    <script>
      const params = new URLSearchParams(window.location.search);
      PT('servers/'+params.get('id'), function(s){
        s = s.attributes;
        PT('servers/'+params.get('id')+'/resources', function(d){
          d = d.attributes;
          document.getElementById('name').innerHTML = s.name;
          document.getElementById('desc').innerHTML = s.description;
          document.getElementById('node').innerHTML = s.node;
          document.getElementById('state').classList.add('status-'+d.current_state);
          document.getElementById('url').innerHTML = `${s.relationships.allocations.data[0].attributes.ip_alias}:${s.relationships.allocations.data[0].attributes.port}<br>${s.relationships.allocations.data[0].attributes.ip}:${s.relationships.allocations.data[0].attributes.port}`;
          document.getElementById('uop').href = `http://${s.relationships.allocations.data[0].attributes.ip_alias}:${s.relationships.allocations.data[0].attributes.port}`;
          document.getElementById('cpu').innerHTML = `CPU:<br>${d.resources.cpu_absolute}%/${s.limits.cpu == 0 ? '∞' : s.limits.cpu}%`;
          document.getElementById('ram').innerHTML = `RAM:<br>${formatBytes(d.resources.memory_bytes)}/${s.limits.memory == 0 ? '∞' : formatBytes(s.limits.memory)}`;
          document.getElementById('disk').innerHTML = `Disk:<br>${formatBytes(d.resources.disk_bytes)}/${s.limits.disk == 0 ? '∞' : formatBytes(s.limits.disk)}`;
          document.getElementById('up').innerHTML = time_gud(Math.floor(d.resources.uptime/1000));
        })      
      })
      function power(ac) {
        PT('servers/'+params.get('id')+'/power', function(){return}, 'POST', `{"signal": "${ac}"}`)
      }
    </script>
  </body>
</html>
